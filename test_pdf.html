<html>
<head>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
  <style>
    .chart-section {
      width: 100%; /* Use 100% of the container width */
      max-width: 190mm; /* Adjust based on your PDF's actual visible area */
      margin-bottom: 20px; /* Add space below the chart */
    }
    .ct-chart {
      padding-bottom: 20px; /* Add padding below the chart */
      height: 300px; /* Adjust the height of the chart as needed */
    }
    .iso-box {
      padding: 10px;
      margin: 10px 0;
      color: #fff;
      border-radius: 5px;
    }
    .chart-legend {
      text-align: center;
      margin-top: 10px;
    }
    .chart-legend .legend-item {
      display: inline-block;
      margin-right: 10px;
    }
    .chart-legend .legend-item i {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 5px;
      border-radius: 50%;
    }
    /* Styles for table pagination */
    table {
      width: 100%;
      border-collapse: collapse;
      page-break-inside: auto;
    }
    tr    { page-break-inside:avoid; page-break-after:auto }
    thead { display:table-header-group }
    tfoot { display:table-footer-group }
    th, td {
      border: 1px solid black;
      padding: 5px;
    }
    /* Styles for the footer */
    .footer {
      text-align: center; /* Center align the footer content */
      margin-top: 20px;
      width: 100%; /* Ensure the footer takes full width */
    }
    .footer-content {
      display: inline-block;
      text-align: center;
    }

    /* Page Break Style */
    .page-break {
      display: block;
      page-break-before: always;
    }

    /* Adjusted styles for ISO threshold boxes */
    .iso-threshold-box {
      padding: 5px; /* Reduced padding */
      border: 1px solid #e0e0e0;
      margin-bottom: 10px; /* Reduced margin */
      display: flex;
      align-items: center; /* Align items vertically */
    }

    .iso-threshold-box > div {
      flex: 0 0 auto; /* Adjust flex settings */
      margin-right: 10px; /* Add some space between text and color indicators */
    }

    .iso-threshold-box span {
      display: flex;
      align-items: center;
      margin-right: 10px; /* Space between each indicator */
    }

    .iso-threshold-box span span {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 5px;
      margin-right: 5px; /* Space between color box and text */
    }
  </style>
  <script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="pdf-header">
      <img src="https://github.com/miningandhydraulics/pdf_tool/blob/main/FuelFix-Logo.png?raw=true" alt="Logo" style="height: 50px;">
      <h1>Fuelfix Diesel Dispense Report</h1>
      <p>${full_date}</p>
    </header>

    <!-- ISO Boxes -->
    <div class="iso-box" style="background-color: ${iso4_color};">ISO4 Average: ${iso4_avg}</div>
    <div class="iso-box" style="background-color: ${iso6_color};">ISO6 Average: ${iso6_avg}</div>
    <div class="iso-box" style="background-color: ${iso14_color};">ISO14 Average: ${iso14_avg}</div>

    <!-- New ISO Threshold Boxes -->
    <div class="iso-threshold-box">
        <div style="font-weight: bold; margin-bottom: 10px;">ISO 4 (≥ 4 µm):</div>
        <div style="margin-bottom: 5px; display: flex; justify-content: space-between;">
            <span>
                <span style="background-color: green;"></span>Green (Good): 16 or lower
            </span>
            <span>
                <span style="background-color: orange;"></span>Orange (Caution): 17-20
            </span>
            <span>
                <span style="background-color: red;"></span>Red (Critical): 21 or higher
            </span>
        </div>
    </div>
    <div class="iso-threshold-box">
        <div style="font-weight: bold; margin-bottom: 10px;">ISO 6 (≥ 6 µm):</div>
        <div style="margin-bottom: 5px; display: flex; justify-content: space-between;">
            <span>
                <span style="background-color: green;"></span>Green (Good): 13 or lower
            </span>
            <span>
                <span style="background-color: orange;"></span>Orange (Caution): 14-16
            </span>
            <span>
                <span style="background-color: red;"></span>Red (Critical): 17 or higher
            </span>
        </div>
    </div>
    <div class="iso-threshold-box">
        <div style="font-weight: bold; margin-bottom: 10px;">ISO 14 (≥ 14 µm):</div>
        <div style="margin-bottom: 5px; display: flex; justify-content: space-between;">
            <span>
                <span style="background-color: green;"></span>Green (Good): 10 or lower
            </span>
            <span>
                <span style="background-color: orange;"></span>Orange (Caution): 11-12
            </span>
            <span>
                <span style="background-color: red;"></span>Red (Critical): 13 or higher
            </span>
        </div>
    </div>

    <!-- Page Break -->
    <div class="page-break"></div>
<!-- Brief Report Section -->
    <div class="report-section">
      <h2>Report Overview</h2>
      <p>This report provides an analysis of the diesel dispense quality as measured by ISO cleanliness standards. The data reflects the particle count in the diesel, categorized by size, and is crucial for assessing the quality and purity of the fuel.</p>

      <h3>ISO Cleanliness Levels:</h3>
      <ul>
        <li>ISO 4 (≥ 4 µm): ${iso4_avg}</li>
        <li>ISO 6 (≥ 6 µm): ${iso6_avg}</li>
        <li>ISO 14 (≥ 14 µm): ${iso14_avg}</li>
      </ul>

      <h3>Analysis and Findings:</h3>
      <p>The ISO cleanliness levels for the diesel dispensed are as follows:</p>
      <ul>
        <p>ISO 4: The current level is ${iso4_avg}, which falls within the [Good/Caution/Critical for ISO 4] category.</p>
        <li>ISO 6: With a level of ${iso6_value}, the fuel is categorized as ${iso6_color}, suggesting that it is [Good/Caution/Critical] for particles of 6 µm and larger.</li>
        <li>ISO 14: The level of ${iso14_value} places the fuel in the ${iso14_color} category, showing that it is [Good/Caution/Critical] for particles of 14 µm and larger.</li>
      </ul>

      <h3>Recommendations:</h3>
      <p>Based on the ISO cleanliness levels, we recommend the following actions:</p>
      <ul>
        <li>[Specific actions based on ISO 4 value]</li>
        <li>[Specific actions based on ISO 6 value]</li>
        <li>[Specific actions based on ISO 14 value]</li>
      </ul>

      <h3>Conclusion:</h3>
      <p>Maintaining optimal fuel cleanliness is crucial for the efficient operation of diesel-powered machinery. Regular monitoring and adherence to ISO cleanliness standards ensure the longevity and reliability of the equipment. This report underscores the importance of ongoing quality checks and the need for appropriate measures to maintain or improve fuel purity.</p>
    </div>
    
<!-- Page Break -->
    
    <!-- Line Chart Section -->
    <div class="chart-section">
      <h2>Raw ISO Chart</h2>
      <section class="line-chart" id="iso-chart"></section>
      <div class="chart-legend">
        <span class="legend-item"><i style="background: #FFA500;"></i> ISO4 (Orange)</span>
        <span class="legend-item"><i style="background: #0000FF;"></i> ISO6 (Blue)</span>
        <span class="legend-item"><i style="background: #800080;"></i> ISO14 (Purple)</span>
      </div>
    </div>

    <!-- Table Section -->
    ${table_content}

    <footer class="footer">
      <div class="footer-content">
        Fuelfix - ${current_year}<br>
        5 Excellence Drive Wangarra WA 6065<br>
        Phone: 1300 734 764
      </div>
    </footer>
  </div>

  <!-- Script for generating the chart -->
  <script>
    var chartLabels = JSON.parse('${chart_labels}');
    var chartSeries = JSON.parse('${chart_series}');
    
    console.log(chartSeries);
    console.log(chartLabels);
    
    new Chartist.Line('#iso-chart', {
      labels: chartLabels,
      series: chartSeries
    }, {
      fullWidth: true,
      showArea: true,
      chartPadding: {
        right: 10,
        left: 10
      },
      axisX: {
        showGrid: true,
        labelInterpolationFnc: function(value, index) {
          return value;
        }
      },
      axisY: {
        showGrid: true,
        onlyInteger: true,
        offset: 20
      },
      lineSmooth: Chartist.Interpolation.simple({
        divisor: 2
      }),
      low: 0
    });
  </script>
</body>
</html>
