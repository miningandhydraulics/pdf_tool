<html>
<head>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
  <style>
    body {
      font-family: 'Fira Sans', sans-serif;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 210mm;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #2c5aa0;
      padding-bottom: 20px;
    }
    .chart-section {
      width: 100%;
      max-width: 190mm;
      margin-bottom: 20px;
    }
    .ct-chart {
      padding-bottom: 20px;
      height: auto;
      width: 100%;
    }
    .health-status-box {
      padding: 15px;
      margin: 10px 0;
      color: #fff;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
    }
    .iso-box {
      padding: 10px;
      margin: 10px 0;
      color: #fff;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .status-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 15px;
      margin: 20px 0;
    }
    .status-card {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    .status-card h3 {
      margin: 0 0 10px 0;
      color: #495057;
      font-size: 14px;
    }
    .status-card .value {
      font-size: 18px;
      font-weight: bold;
      padding: 8px;
      border-radius: 4px;
      color: white;
    }
    .centered-title {
      text-align: center;
      color: #2c5aa0;
    }
    .report-date {
      text-align: center;
      font-size: 16px;
      margin: 10px 0;
    }
    .device-info {
      text-align: center;
      background: #e9ecef;
      padding: 10px;
      border-radius: 5px;
      margin: 15px 0;
    }
    .chart-legend {
      text-align: center;
      margin-top: 10px;
    }
    .chart-legend .legend-item {
      display: inline-block;
      margin-right: 15px;
    }
    .chart-container {
      page-break-inside: avoid;
    }
    .chart-legend .legend-item i {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 5px;
      border-radius: 50%;
    }
    .recommendations-section {
      background: #f8f9fa;
      border-left: 4px solid #007bff;
      padding: 20px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .recommendations-section h3 {
      color: #007bff;
      margin-top: 0;
    }
    .wear-analysis {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      page-break-inside: auto;
      margin: 20px 0;
    }
    tr { 
      page-break-inside: avoid; 
      page-break-after: auto;
    }
    thead { 
      display: table-header-group;
      background-color: #2c5aa0;
      color: white;
    }
    tfoot { 
      display: table-footer-group;
    }
    th, td {
      border: 1px solid #dee2e6;
      padding: 8px;
      text-align: center;
    }
    th {
      font-weight: bold;
    }
    tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    .footer {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
      color: #6c757d;
    }
    .footer-content {
      display: inline-block;
      text-align: center;
    }
    .page-break {
      display: block;
      page-break-before: always;
    }
    .section-title {
      color: #2c5aa0;
      border-bottom: 2px solid #2c5aa0;
      padding-bottom: 5px;
      margin: 25px 0 15px 0;
    }
    .alert-critical {
      background-color: #dc3545;
      color: white;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
    }
    .alert-warning {
      background-color: #ffc107;
      color: #212529;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
    }
    .alert-success {
      background-color: #28a745;
      color: white;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://github.com/miningandhydraulics/pdf_tool/blob/main/ufp-logo.png?raw=true" alt="Logo" style="height: 50px;">
      <h1 class="centered-title">United Fluid Power - Oil Analysis Report</h1>
      <p class="report-date">Report Date: ${full_date}</p>
      <div class="device-info">
        <strong>Device Serial:</strong> ${device_serial} | <strong>Location:</strong> ${device_location}
      </div>
    </div>

    <!-- Overall Health Status -->
    <div class="health-status-box" style="background-color: ${overall_health_color};">
      OVERALL OIL HEALTH: ${overall_health_status}
    </div>

    <!-- Status Grid -->
    <div class="status-grid">
      <div class="status-card">
        <h3>ISO Cleanliness</h3>
        <div class="value" style="background-color: ${iso_status_color};">
          ${iso_status}
        </div>
        <small>Current: ${iso_code_current}</small>
      </div>
      <div class="status-card">
        <h3>Oil Condition</h3>
        <div class="value" style="background-color: ${oil_condition_color};">
          ${oil_condition}
        </div>
      </div>
      <div class="status-card">
        <h3>Machine Health</h3>
        <div class="value" style="background-color: ${machine_health_color};">
          ${machine_health}
        </div>
      </div>
    </div>

    <!-- Wear Analysis Section -->
    <div class="wear-analysis">
      <h3 style="margin-top: 0; color: #856404;">Wear Particle Analysis</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
          <strong>Primary Wear Mode:</strong> ${primary_wear_mode}<br>
          <strong>Wear Severity:</strong> ${wear_severity}
        </div>
        <div>
          <strong>Total Wear Particles:</strong> ${total_wear_particles}<br>
          <strong>Health Priority:</strong> ${health_priority}/10
        </div>
      </div>
    </div>

    <!-- ISO Readings -->
    <h2 class="section-title">ISO Cleanliness Readings</h2>
    <div class="iso-box" style="background-color: ${iso4_color};">
      <span>ISO 4 (≥4μm): ${iso4_avg}</span>
      <span>${iso4_status}</span>
    </div>
    <div class="iso-box" style="background-color: ${iso6_color};">
      <span>ISO 6 (≥6μm): ${iso6_avg}</span>
      <span>${iso6_status}</span>
    </div>
    <div class="iso-box" style="background-color: ${iso14_color};">
      <span>ISO 14 (≥14μm): ${iso14_avg}</span>
      <span>${iso14_status}</span>
    </div>

    <!-- Recommendations Section -->
    <div class="recommendations-section">
      <h3>Recommendations & Actions</h3>
      <p>${recommendations}</p>
    </div>

    <!-- Environmental Conditions -->
    <h2 class="section-title">Environmental Conditions</h2>
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 15px 0;">
      <div class="status-card">
        <h3>Temperature</h3>
        <div class="value" style="background-color: ${temperature_status_color}; color: white;">
          ${temperature_avg}°C
        </div>
        <small>Status: ${temperature_status}</small>
      </div>
      <div class="status-card">
        <h3>Humidity</h3>
        <div class="value" style="background-color: #6c757d; color: white;">
          ${humidity_avg}%
        </div>
      </div>
      <div class="status-card">
        <h3>Oil Degradation</h3>
        <div class="value" style="background-color: #6c757d; color: white;">
          ${oil_degradation_avg}%
        </div>
      </div>
    </div>

    <!-- Page Break -->
    <div class="page-break"></div>

    <!-- Line Chart Section -->
    <div class="chart-container chart-section">
      <h2 class="section-title">24-Hour Trend Analysis</h2>
      <section class="ct-chart line-chart" id="oil-chart"></section>
      <div class="chart-legend">
        <span class="legend-item"><i style="background: #dc3545;"></i> Health Priority</span>
        <span class="legend-item"><i style="background: #007bff;"></i> Temperature (°C)</span>
        <span class="legend-item"><i style="background: #28a745;"></i> Total Particles (÷100)</span>
      </div>
    </div>

    <!-- Page Break -->
    <div class="page-break"></div>

    <!-- Detailed Analysis Section -->
    <div>
      <h2 class="section-title">Detailed Analysis</h2>
      
      <h3>Oil Health Assessment:</h3>
      <p>The current oil analysis indicates an overall health status of <strong>${overall_health_status}</strong>. 
      This assessment is based on multiple factors including particle contamination, wear debris analysis, 
      and oil condition evaluation.</p>

      <h3>ISO Cleanliness Analysis:</h3>
      <p>The ISO 4406 cleanliness code is currently <strong>${iso_code_current}</strong> with a status of <strong>${iso_status}</strong>. 
      This represents the contamination level of particles ≥4μm, ≥6μm, and ≥14μm per milliliter of oil.</p>

      <h3>Wear Pattern Analysis:</h3>
      <p>The primary wear mode detected is <strong>${primary_wear_mode}</strong> with <strong>${wear_severity}</strong> severity. 
      This indicates the type of mechanical wear occurring in the system and its current progression level.</p>

      <h3>Sample Quality:</h3>
      <p>Sample quality assessment: <strong>${sample_quality}</strong>. This ensures the reliability and accuracy of the analysis results.</p>
    </div>

    <!-- Page Break -->
    <div class="page-break"></div>

    <!-- Hourly Data Table -->
    <h2 class="section-title">Hourly Analysis Summary</h2>
    <table>
      <thead>
        <tr>
          <th>Hour</th>
          <th>ISO 4</th>
          <th>ISO 6</th>
          <th>ISO 14</th>
          <th>Oil Health</th>
          <th>Temp (°C)</th>
          <th>Primary Wear</th>
          <th>Priority</th>
        </tr>
      </thead>
      <tbody>
        ${table_content}
      </tbody>
    </table>

    <footer class="footer">
      <div class="footer-content">
        United Fluid Power - Oil Analysis Division<br>
        17 Cutting Way Yangebup WA 6164<br>
        Phone: 9418 8522 | Email: info@unitedfluidpower.com.au<br>
        Report Generated: ${current_year}
      </div>
    </footer>
  </div>

  <!-- Script for generating the chart -->
  <script>
    var chartLabels = JSON.parse('${chart_labels}');
    var chartSeries = JSON.parse('${chart_series}');
    
    console.log('Chart Data:', chartSeries);
    console.log('Chart Labels:', chartLabels);
    
    new Chartist.Line('#oil-chart', {
      labels: chartLabels,
      series: chartSeries
    }, {
      fullWidth: true,
      showArea: false,
      chartPadding: {
        right: 40,
        left: 40,
        top: 20,
        bottom: 20
      },
      axisX: {
        showGrid: true,
        labelInterpolationFnc: function(value, index) {
          // Show every 4th label to avoid crowding
          return index % 4 === 0 ? value.split(' ')[1] : '';
        }
      },
      axisY: {
        showGrid: true,
        onlyInteger: true,
        offset: 40
      },
      lineSmooth: Chartist.Interpolation.simple({
        divisor: 2
      }),
      low: 0,
      height: '300px',
      width: '100%',
      series: {
        'Health Priority': {
          lineColor: '#dc3545',
          strokeWidth: 3
        },
        'Temperature': {
          lineColor: '#007bff',
          strokeWidth: 2
        },
        'Total Particles': {
          lineColor: '#28a745',
          strokeWidth: 2
        }
      }
    });
  </script>
  
  <script>
    // Set current year
    document.addEventListener('DOMContentLoaded', function() {
      const yearElements = document.querySelectorAll('[data-year]');
      const currentYear = new Date().getFullYear();
      yearElements.forEach(element => {
        element.textContent = currentYear;
      });
    });
  </script>
</body>
</html>
